<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetStar Knowledge Base Search</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .highlight {
            background-color: #ffffcc;
            font-weight: bold;
        }
        .result-card {
            transition: transform 0.2s;
            border: 1px solid #e5e7eb;
        }
        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .tab {
            cursor: pointer;
            padding: 10px 15px;
            border-bottom: 2px solid transparent;
        }
        .tab.active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
            font-weight: 500;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold text-center mb-2 text-blue-800">NetStar Inc. - Vendor & Technology Information</h1>
        
        <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex flex-col md:flex-row gap-2">
                <input type="text" id="searchInput" class="flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                       placeholder="Search for vendors, files, or technologies...">
                <button id="searchButton" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md">
                    Search
                </button>
            </div>
            <div class="text-sm text-gray-500 mt-2">
                Try searching for: "GoTo", "cloud", "integrations", "docx"
            </div>
            <div class="mt-3">
                <label class="flex items-center">
                    <input type="checkbox" id="includeWebResults" checked class="mr-2">
                    <span>Include web search results</span>
                </label>
            </div>
        </div>

        <div id="resultsSection" class="max-w-4xl mx-auto">
            <div id="loadingIndicator" class="hidden text-center py-4">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-700"></div>
                <p class="mt-2">Searching...</p>
            </div>
            
            <div id="initialMessage" class="text-center text-gray-500 py-8">
                Enter a search term to find information from the knowledge base
            </div>
            
            <div id="noResults" class="hidden text-center bg-gray-50 p-6 rounded-lg">
                <p class="text-gray-700">No results found for your search.</p>
                <p class="text-gray-500 mt-2">Try a different search term or check spelling.</p>
            </div>
            
            <div id="tabsContainer" class="hidden border-b border-gray-200 mb-6">
                <div class="flex">
                    <div class="tab active" data-tab="kb">Knowledge Base (<span id="kbCount">0</span>)</div>
                    <div class="tab" data-tab="web">Web Results (<span id="webCount">0</span>)</div>
                </div>
            </div>
            
            <div id="kbResults" class="tab-content active space-y-4"></div>
            <div id="webResults" class="tab-content space-y-4"></div>
        </div>
    </div>

    <script>
        // Main elements
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const includeWebResults = document.getElementById('includeWebResults');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const initialMessage = document.getElementById('initialMessage');
        const noResults = document.getElementById('noResults');
        const tabsContainer = document.getElementById('tabsContainer');
        const kbResults = document.getElementById('kbResults');
        const webResults = document.getElementById('webResults');
        const kbCount = document.getElementById('kbCount');
        const webCount = document.getElementById('webCount');
        
        // Knowledge base data
        let knowledgeBase = null;
        
        // Set up tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Deactivate all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                // Activate clicked tab
                this.classList.add('active');
                
                // Hide all tab content
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // Show corresponding content
                const tabName = this.getAttribute('data-tab');
                document.getElementById(tabName + 'Results').classList.add('active');
            });
        });
        
        // Load knowledge base
        async function loadKnowledgeBase() {
            try {
                console.log('Loading knowledge base...');
                const response = await fetch('https://raw.githubusercontent.com/Sladed49er/email-ai-knowledge-base/main/knowledge-base.json');
                const data = await response.json();
                knowledgeBase = data;
                console.log('Knowledge base loaded:', knowledgeBase);
                
                // Check for URL query parameter
                const params = new URLSearchParams(window.location.search);
                const query = params.get('q');
                if (query) {
                    searchInput.value = query;
                    performSearch();
                }
            } catch (error) {
                console.error('Error loading knowledge base:', error);
                kbResults.innerHTML = `
                    <div class="bg-red-100 text-red-700 p-4 rounded-lg">
                        <p class="font-bold">Error loading knowledge base</p>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Perform search
        async function performSearch() {
            const query = searchInput.value.trim().toLowerCase();
            if (!query) return;
            
            // Update URL
            history.replaceState(null, '', `?q=${encodeURIComponent(query)}`);
            
            // Show loading, hide other sections
            loadingIndicator.classList.remove('hidden');
            initialMessage.classList.add('hidden');
            noResults.classList.add('hidden');
            tabsContainer.classList.add('hidden');
            kbResults.innerHTML = '';
            webResults.innerHTML = '';
            
            // Perform searches
            let kbSearchResults = [];
            if (knowledgeBase && knowledgeBase.vendors) {
                console.log('Searching knowledge base for:', query);
                kbSearchResults = searchVendors(query);
            }
            
            let webSearchResults = [];
            if (includeWebResults.checked) {
                console.log('Generating web results for:', query);
                webSearchResults = await generateWebResults(query);
            }
            
            // Update result counts
            kbCount.textContent = kbSearchResults.length;
            webCount.textContent = webSearchResults.length;
            
            // Hide loading indicator
            loadingIndicator.classList.add('hidden');
            
            // Display results or no results message
            if (kbSearchResults.length > 0 || webSearchResults.length > 0) {
                tabsContainer.classList.remove('hidden');
                
                // Display KB results
                if (kbSearchResults.length > 0) {
                    kbSearchResults.forEach(item => {
                        displayKBResult(item, query);
                    });
                } else {
                    kbResults.innerHTML = `
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <p class="text-gray-700">No knowledge base results for "${query}"</p>
                        </div>
                    `;
                }
                
                // Display web results
                if (webSearchResults.length > 0) {
                    webSearchResults.forEach(item => {
                        displayWebResult(item, query);
                    });
                } else {
                    webResults.innerHTML = `
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <p class="text-gray-700">No web results for "${query}"</p>
                        </div>
                    `;
                }
                
                // If no KB results but has web results, switch to web tab
                if (kbSearchResults.length === 0 && webSearchResults.length > 0) {
                    document.querySelector('.tab[data-tab="web"]').click();
                }
            } else {
                noResults.classList.remove('hidden');
            }
        }
        
        // Search through vendors
        function searchVendors(query) {
            const results = [];
            
            // Debug log the knowledge base structure
            console.log('Knowledge base structure:', knowledgeBase);
            
            // Make sure vendors array exists
            if (!knowledgeBase || !knowledgeBase.vendors || !Array.isArray(knowledgeBase.vendors)) {
                console.error('Knowledge base has no vendors array or is not in expected format');
                return results;
            }
            
            // Search through each vendor
            knowledgeBase.vendors.forEach(vendor => {
                // Convert to string for searching
                const vendorString = JSON.stringify(vendor).toLowerCase();
                
                // Check if vendor contains the query
                if (vendorString.includes(query)) {
                    results.push(vendor);
                }
            });
            
            console.log(`Found ${results.length} results for "${query}"`);
            return results;
        }
        
        // Display a knowledge base result
        function displayKBResult(vendor, query) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-md p-5 mb-4 result-card';
            
            // Determine file type and icon
            let icon = 'fa-file';
            let iconColor = 'text-blue-500';
            
            if (vendor.name) {
                const ext = vendor.name.split('.').pop().toLowerCase();
                if (ext === 'pdf') {
                    icon = 'fa-file-pdf';
                    iconColor = 'text-red-500';
                } else if (['doc', 'docx'].includes(ext)) {
                    icon = 'fa-file-word';
                    iconColor = 'text-blue-600';
                } else if (['xls', 'xlsx', 'csv'].includes(ext)) {
                    icon = 'fa-file-excel';
                    iconColor = 'text-green-600';
                } else if (ext === 'txt') {
                    icon = 'fa-file-alt';
                    iconColor = 'text-gray-600';
                }
            }
            
            // Create HTML for card
            let html = `
                <div class="flex items-start">
                    <div class="mr-3 text-2xl ${iconColor}">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold text-blue-700 mb-2">
                            ${highlightText(vendor.name || 'Vendor Document', query)}
                        </h3>
                        <div class="mb-4">
                            <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">Vendor Document</span>
                            ${vendor.source_file ? `<span class="text-sm text-gray-500 ml-2">Source: ${vendor.source_file}</span>` : ''}
                        </div>
                        
                        <div class="space-y-3">
            `;
            
            // Add properties table
            html += '<table class="w-full border-collapse">';
            
            // Add each property
            Object.entries(vendor).forEach(([key, value]) => {
                // Skip name as it's already displayed in the title
                if (key === 'name') return;
                
                const formattedKey = key.split('_').map(word => 
                    word.charAt(0).toUpperCase() + word.slice(1)
                ).join(' ');
                
                html += `
                    <tr class="border-b border-gray-200">
                        <td class="py-2 px-3 bg-gray-50 font-medium text-gray-700 w-1/3">${formattedKey}</td>
                        <td class="py-2 px-3">${formatValue(value, query)}</td>
                    </tr>
                `;
            });
            
            html += `
                        </table>
                    </div>
                </div>
            `;
            
            card.innerHTML = html;
            kbResults.appendChild(card);
        }
        
        // Format a value for display
        function formatValue(value, query) {
            if (value === null || value === undefined) {
                return '<span class="text-gray-400">None</span>';
            }
            
            // Handle arrays
            if (Array.isArray(value)) {
                if (value.length === 0) {
                    return '<span class="text-gray-400">Empty list</span>';
                }
                
                let html = '<ul class="list-disc pl-5 space-y-1">';
                value.forEach(item => {
                    html += `<li>${highlightText(item.toString(), query)}</li>`;
                });
                html += '</ul>';
                return html;
            }
            
            // Handle objects
            if (typeof value === 'object') {
                let html = '<div class="pl-3 border-l-2 border-gray-200 space-y-1">';
                Object.entries(value).forEach(([k, v]) => {
                    const formattedKey = k.split('_').map(word => 
                        word.charAt(0).toUpperCase() + word.slice(1)
                    ).join(' ');
                    
                    html += `<div><span class="font-medium">${formattedKey}:</span> ${
                        typeof v === 'object' ? JSON.stringify(v) : highlightText(v.toString(), query)
                    }</div>`;
                });
                html += '</div>';
                return html;
            }
            
            // Handle strings that look like JSON
            if (typeof value === 'string' && 
                ((value.startsWith('{') && value.endsWith('}')) || 
                 (value.startsWith('[') && value.endsWith(']')))) {
                try {
                    // Try to parse as JSON
                    const jsonValue = JSON.parse(value.replace(/'/g, '"'));
                    
                    if (Array.isArray(jsonValue)) {
                        // Format as list
                        if (jsonValue.length === 0) {
                            return '<span class="text-gray-400">Empty list</span>';
                        }
                        
                        let html = '<ul class="list-disc pl-5 space-y-1">';
                        jsonValue.forEach(item => {
                            html += `<li>${highlightText(item.toString(), query)}</li>`;
                        });
                        html += '</ul>';
                        return html;
                    } else {
                        // Format as object
                        let html = '<div class="pl-3 border-l-2 border-gray-200 space-y-1">';
                        Object.entries(jsonValue).forEach(([k, v]) => {
                            const formattedKey = k.split('_').map(word => 
                                word.charAt(0).toUpperCase() + word.slice(1)
                            ).join(' ');
                            
                            html += `<div><span class="font-medium">${formattedKey}:</span> ${
                                typeof v === 'object' ? JSON.stringify(v) : highlightText(v.toString(), query)
                            }</div>`;
                        });
                        html += '</div>';
                        return html;
                    }
                } catch (e) {
                    // If JSON parsing fails, treat as normal string
                    console.log('Failed to parse as JSON:', value);
                }
            }
            
            // Default: handle as string
            return highlightText(value.toString(), query);
        }
        
        // Generate web search results
        async function generateWebResults(query) {
            // This is a simulated web search - in a real app, you would call a search API
            
            // Check for specific vendor/technology names
            const vendorKeywords = {
                'goto': 'GoTo',
                'microsoft': 'Microsoft',
                '8x8': '8x8',
                'ringcentral': 'RingCentral',
                'zoom': 'Zoom',
                'nextiva': 'Nextiva',
                'adobe': 'Adobe'
            };
            
            const results = [];
            let matchedVendor = null;
            
            // Check if query contains a vendor name
            for (const [keyword, name] of Object.entries(vendorKeywords)) {
                if (query.includes(keyword)) {
                    matchedVendor = name;
                    break;
                }
            }
            
            // Add vendor-specific results
            if (matchedVendor) {
                results.push({
                    title: `${matchedVendor} - Official Website`,
                    url: `https://www.${matchedVendor.toLowerCase().replace(/\s+/g, '')}.com`,
                    description: `Official website for ${matchedVendor}. Find products, services, support resources, and documentation.`
                });
                
                // For integration-related searches
                if (query.includes('integration') || query.includes('connect')) {
                    results.push({
                        title: `${matchedVendor} Integration Guide`,
                        url: `https://developer.${matchedVendor.toLowerCase().replace(/\s+/g, '')}.com/integrations`,
                        description: `Comprehensive guide to integrating with ${matchedVendor}. API documentation, tutorials, and code examples.`
                    });
                }
            }
            
            // For cloud-related searches
            if (query.includes('cloud')) {
                results.push({
                    title: 'Top Cloud Service Providers in 2025',
                    url: 'https://www.techradar.com/best/best-cloud-providers',
                    description: 'Our guide to the best cloud providers for business, featuring AWS, Microsoft Azure, Google Cloud Platform, and more.'
                });
                
                results.push({
                    title: 'Gartner Magic Quadrant for Cloud Infrastructure',
                    url: 'https://www.gartner.com/doc/reprints?id=1-27BUUJBA&ct=220727',
                    description: "Gartner's analysis of cloud infrastructure and platform service providers, highlighting leaders, challengers, visionaries, and niche players."
                });
            }
            
            // For VoIP-related searches
            if (query.includes('voip') || query.includes('phone')) {
                results.push({
                    title: 'Best Business VoIP Providers of 2025',
                    url: 'https://www.business.org/services/phone/best-business-voip-providers/',
                    description: 'Compare the top VoIP phone systems for businesses. Find pricing, features, and the best option for your company size and needs.'
                });
            }
            
            // Add a generic result if none specific
            if (results.length === 0) {
                results.push({
                    title: `Search results for: ${query}`,
                    url: `https://www.google.com/search?q=${encodeURIComponent(query)}`,
                    description: 'Find more information about this topic on Google.'
                });
            }
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 300));
            
            return results;
        }
        
        // Display a web search result
        function displayWebResult(result, query) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-md p-5 mb-4 result-card';
            
            card.innerHTML = `
                <div class="flex items-start">
                    <div class="mr-3 text-2xl text-blue-500">
                        <i class="fas fa-globe"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-blue-700 mb-1">
                            ${highlightText(result.title, query)}
                        </h3>
                        <a href="${result.url}" target="_blank" class="text-green-600 text-sm hover:underline block mb-2">
                            ${result.url}
                        </a>
                        <p class="text-gray-700">
                            ${highlightText(result.description, query)}
                        </p>
                    </div>
                </div>
            `;
            
            webResults.appendChild(card);
        }
        
        // Highlight text matching the search query
        function highlightText(text, query) {
            if (!text || !query) return text;
            
            // Split query into words
            const words = query.split(/\s+/).filter(word => word.length > 2);
            let result = text;
            
            // Highlight each word
            words.forEach(word => {
                const regex = new RegExp('(' + escapeRegex(word) + ')', 'gi');
                result = result.replace(regex, '<span class="highlight">$1</span>');
            });
            
            return result;
        }
        
        // Escape special regex characters
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        // Set up event listeners
        searchButton.addEventListener('click', performSearch);
        searchInput.addEventListener('keydown', event => {
            if (event.key === 'Enter') performSearch();
        });
        
        // Load knowledge base when page loads
        document.addEventListener('DOMContentLoaded', loadKnowledgeBase);
    </script>
</body>
</html>
