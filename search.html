<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetStar Knowledge Base Search</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .highlight {
            background-color: #ffffcc;
            padding: 0 2px;
        }
        .result-card {
            transition: transform 0.2s;
        }
        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 1rem;
        }
        .tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .tab.active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
            font-weight: 500;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .icon {
            margin-right: 8px;
        }
        .icon-word {
            color: #2b579a;
        }
        .icon-pdf {
            color: #e74c3c;
        }
        .icon-excel {
            color: #27ae60;
        }
        .icon-csv {
            color: #27ae60;
        }
        .icon-txt {
            color: #3498db;
        }
        .icon-globe {
            color: #3498db;
        }
        .property-table {
            width: 100%;
            border-collapse: collapse;
        }
        .property-table tr {
            border-bottom: 1px solid #e5e7eb;
        }
        .property-table tr:last-child {
            border-bottom: none;
        }
        .property-label {
            font-weight: 600;
            padding: 8px;
            background-color: #f9fafb;
            width: 160px;
            vertical-align: top;
        }
        .property-value {
            padding: 8px;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-blue-800">Knowledge Base Search</h1>
            <p class="text-lg text-gray-600 mt-2">NetStar Inc. - Vendor & Technology Information</p>
        </header>

        <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex flex-col md:flex-row gap-2">
                <input type="text" id="searchInput" placeholder="Search for vendors, technologies, or documents..." 
                       class="flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="searchButton" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md">
                    Search
                </button>
            </div>
            <div class="mt-2 text-sm text-gray-500">
                Try searching for: "GoTo", "cloud", "integrations", "docx", etc.
            </div>
            <div class="mt-3">
                <label class="inline-flex items-center">
                    <input type="checkbox" id="includeWebResults" class="form-checkbox h-4 w-4 text-blue-600" checked>
                    <span class="ml-2 text-gray-700">Include web search results</span>
                </label>
            </div>
        </div>

        <div id="searchResults" class="max-w-4xl mx-auto">
            <div id="initialMessage" class="text-center text-gray-500 py-8">
                Enter a search term to find information from your knowledge base
            </div>
            
            <div id="resultsContainer" class="hidden">
                <div class="tabs">
                    <div class="tab active" data-tab="kb">Knowledge Base (<span id="kbCount">0</span>)</div>
                    <div class="tab" data-tab="web">Web Results (<span id="webCount">0</span>)</div>
                </div>
                
                <div id="kbResults" class="tab-content active space-y-4"></div>
                <div id="webResults" class="tab-content space-y-4"></div>
            </div>
            
            <div id="loadingIndicator" class="hidden text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                <p class="mt-2 text-gray-600">Searching...</p>
            </div>
            
            <div id="noResults" class="hidden text-center py-8 bg-gray-50 rounded-lg">
                <p class="text-gray-700">No results found. Try a different search term.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const includeWebResults = document.getElementById('includeWebResults');
            const initialMessage = document.getElementById('initialMessage');
            const resultsContainer = document.getElementById('resultsContainer');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const noResults = document.getElementById('noResults');
            const kbResults = document.getElementById('kbResults');
            const webResults = document.getElementById('webResults');
            const kbCount = document.getElementById('kbCount');
            const webCount = document.getElementById('webCount');
            
            let knowledgeBase = null;
            
            // Set up tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const tabName = this.getAttribute('data-tab');
                    document.getElementById(tabName + 'Results').classList.add('active');
                });
            });

            // Load knowledge base
            async function loadKnowledgeBase() {
                try {
                    const response = await fetch('https://raw.githubusercontent.com/Sladed49er/email-ai-knowledge-base/main/knowledge-base.json');
                    knowledgeBase = await response.json();
                    console.log('Knowledge base loaded:', knowledgeBase);
                    
                    // Check for URL query parameter
                    const urlParams = new URLSearchParams(window.location.search);
                    const query = urlParams.get('q');
                    if (query) {
                        searchInput.value = query;
                        performSearch();
                    }
                } catch (error) {
                    console.error('Error loading knowledge base:', error);
                    kbResults.innerHTML = `
                        <div class="bg-red-100 text-red-700 p-4 rounded-lg">
                            <p class="font-medium">Error loading knowledge base</p>
                            <p>Please check your internet connection or try again later.</p>
                        </div>
                    `;
                }
            }
            
            // Perform search
            async function performSearch() {
                const query = searchInput.value.trim();
                if (!query) return;
                
                // Update URL
                history.replaceState(null, '', `?q=${encodeURIComponent(query)}`);
                
                // Show loading indicator
                initialMessage.style.display = 'none';
                resultsContainer.classList.add('hidden');
                noResults.classList.add('hidden');
                loadingIndicator.classList.remove('hidden');
                
                // Clear previous results
                kbResults.innerHTML = '';
                webResults.innerHTML = '';
                
                // Search knowledge base
                const kbSearchResults = searchKnowledgeBase(query);
                
                // Generate web results if enabled
                let webSearchResults = [];
                if (includeWebResults.checked) {
                    webSearchResults = await generateWebResults(query);
                }
                
                // Update counts
                kbCount.textContent = kbSearchResults.length;
                webCount.textContent = webSearchResults.length;
                
                // Display results
                if (kbSearchResults.length > 0) {
                    kbSearchResults.forEach(result => {
                        displayKnowledgeBaseResult(result, query);
                    });
                } else {
                    kbResults.innerHTML = `
                        <div class="bg-gray-50 p-4 rounded-lg text-center">
                            <p class="text-gray-700">No knowledge base results found for "${query}"</p>
                        </div>
                    `;
                }
                
                if (webSearchResults.length > 0) {
                    webSearchResults.forEach(result => {
                        displayWebResult(result, query);
                    });
                } else {
                    webResults.innerHTML = `
                        <div class="bg-gray-50 p-4 rounded-lg text-center">
                            <p class="text-gray-700">No web results found for "${query}"</p>
                        </div>
                    `;
                }
                
                // Hide loading indicator and show results
                loadingIndicator.classList.add('hidden');
                
                if (kbSearchResults.length === 0 && webSearchResults.length === 0) {
                    noResults.classList.remove('hidden');
                } else {
                    resultsContainer.classList.remove('hidden');
                    
                    // If no KB results but has web results, switch to web tab
                    if (kbSearchResults.length === 0 && webSearchResults.length > 0) {
                        document.querySelector('.tab[data-tab="web"]').click();
                    }
                }
            }
            
            // Search knowledge base for the specified query
            function searchKnowledgeBase(query) {
                if (!knowledgeBase || !knowledgeBase.vendors) return [];
                
                const results = [];
                const seenItems = new Set();
                const queryLower = query.toLowerCase();
                
                // Search through vendors array
                knowledgeBase.vendors.forEach(vendor => {
                    // Check if any part of the vendor object matches the query
                    const vendorStr = JSON.stringify(vendor).toLowerCase();
                    if (vendorStr.includes(queryLower)) {
                        // Create a unique ID for this result to avoid duplicates
                        const resultId = vendor.name || JSON.stringify(vendor).substring(0, 50);
                        if (!seenItems.has(resultId)) {
                            results.push(vendor);
                            seenItems.add(resultId);
                        }
                    }
                });
                
                return results;
            }
            
            // Generate web search results for the specified query
            async function generateWebResults(query) {
                // This is a simulated web search
                // In a real implementation, you would call a search API
                
                const queryLower = query.toLowerCase();
                const results = [];
                
                // Check for known vendors/technologies in query
                const vendorKeywords = {
                    'goto': 'GoTo',
                    'microsoft': 'Microsoft',
                    'ringcentral': 'RingCentral',
                    '8x8': '8x8',
                    'nextiva': 'Nextiva',
                    'zoom': 'Zoom',
                    'spectrum': 'Spectrum',
                    'comcast': 'Comcast',
                    'adobe': 'Adobe'
                };
                
                let matchedVendor = null;
                
                // Look for vendor matches
                for (const [keyword, vendorName] of Object.entries(vendorKeywords)) {
                    if (queryLower.includes(keyword)) {
                        matchedVendor = vendorName;
                        break;
                    }
                }
                
                // Generate vendor-specific results
                if (matchedVendor) {
                    results.push({
                        title: `${matchedVendor} - Official Website`,
                        url: `https://www.${matchedVendor.toLowerCase().replace(/\s+/g, '')}.com`,
                        description: `Official website for ${matchedVendor}. Find products, services, support resources, and documentation.`
                    });
                    
                    if (queryLower.includes('integration') || queryLower.includes('connect')) {
                        results.push({
                            title: `${matchedVendor} Integration Documentation`,
                            url: `https://developer.${matchedVendor.toLowerCase().replace(/\s+/g, '')}.com`,
                            description: `Learn how to integrate ${matchedVendor} with other systems and services. Find API documentation, tutorials, and examples.`
                        });
                    }
                    
                    if (queryLower.includes('cloud')) {
                        results.push({
                            title: `${matchedVendor} Cloud Services`,
                            url: `https://www.${matchedVendor.toLowerCase().replace(/\s+/g, '')}.com/cloud`,
                            description: `Explore ${matchedVendor}'s cloud offerings including infrastructure, platform, and software-as-a-service solutions.`
                        });
                    }
                    
                    results.push({
                        title: `${matchedVendor} Reviews and Alternatives`,
                        url: `https://www.g2.com/products/${matchedVendor.toLowerCase().replace(/\s+/g, '-')}/reviews`,
                        description: `Read real user reviews of ${matchedVendor} and compare with alternative solutions. See pricing, features, and customer ratings.`
                    });
                }
                
                // For more generic topics
                if (queryLower.includes('cloud')) {
                    results.push({
                        title: 'Top Cloud Service Providers for Businesses',
                        url: 'https://www.gartner.com/reviews/market/cloud-infrastructure-and-platform-services',
                        description: 'Compare the top cloud service providers including AWS, Microsoft Azure, Google Cloud, and more. Features, pricing, and expert analysis.'
                    });
                }
                
                if (queryLower.includes('voip') || queryLower.includes('phone')) {
                    results.push({
                        title: 'Best Business VoIP Providers of 2025',
                        url: 'https://www.business.org/services/phone/best-business-voip-providers/',
                        description: 'Compare the top VoIP phone systems for businesses. Find pricing, features, and the best option for your company size and needs.'
                    });
                }
                
                // If no specific results yet, add generic ones
                if (results.length === 0) {
                    results.push({
                        title: `Search results for: ${query}`,
                        url: `https://www.google.com/search?q=${encodeURIComponent(query)}`,
                        description: 'Find more information about this topic on Google.'
                    });
                    
                    results.push({
                        title: 'NetStar Knowledge Base',
                        url: 'https://sladed49er.github.io/email-ai-knowledge-base/',
                        description: 'Search our internal knowledge base for information about vendors, technologies, and services.'
                    });
                }
                
                // Limit to 5 results
                return results.slice(0, 5);
            }
            
            // Display a knowledge base result
            function displayKnowledgeBaseResult(vendor, query) {
                const card = document.createElement('div');
                card.className = 'bg-white p-5 rounded-lg shadow-md result-card mb-4';
                
                // Determine document type and icon
                let docType = 'default';
                let docIcon = 'fa-file';
                let docIconClass = '';
                
                if (vendor.name) {
                    const fileExt = vendor.name.split('.').pop().toLowerCase();
                    if (['doc', 'docx'].includes(fileExt)) {
                        docType = 'word';
                        docIcon = 'fa-file-word';
                        docIconClass = 'icon-word';
                    } else if (['xls', 'xlsx'].includes(fileExt)) {
                        docType = 'excel';
                        docIcon = 'fa-file-excel';
                        docIconClass = 'icon-excel';
                    } else if (fileExt === 'pdf') {
                        docType = 'pdf';
                        docIcon = 'fa-file-pdf';
                        docIconClass = 'icon-pdf';
                    } else if (fileExt === 'csv') {
                        docType = 'csv';
                        docIcon = 'fa-file-csv';
                        docIconClass = 'icon-csv';
                    } else if (fileExt === 'txt') {
                        docType = 'txt';
                        docIcon = 'fa-file-alt';
                        docIconClass = 'icon-txt';
                    }
                }
                
                // Create card header
                const title = vendor.name || 'Vendor Record';
                
                let html = `
                    <div class="flex items-center mb-3">
                        <i class="fas ${docIcon} text-2xl mr-2 ${docIconClass}"></i>
                        <h3 class="text-xl font-semibold text-blue-700">${highlightText(title, query)}</h3>
                    </div>
                    <div class="mb-4">
                        <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">
                            Vendor
                        </span>
                    </div>
                `;
                
                // Create property table
                html += '<table class="property-table w-full">';
                
                // Add each property
                Object.entries(vendor).forEach(([key, value]) => {
                    // Skip name as it's already in the title
                    if (key === 'name') return;
                    
                    html += `
                        <tr>
                            <td class="property-label">${formatKey(key)}</td>
                            <td class="property-value">${formatPropertyValue(value, query)}</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
                
                card.innerHTML = html;
                kbResults.appendChild(card);
            }
            
            // Display a web search result
            function displayWebResult(result, query) {
                const card = document.createElement('div');
                card.className = 'bg-white p-5 rounded-lg shadow-md result-card mb-4';
                
                const html = `
                    <div class="flex items-center mb-2">
                        <i class="fas fa-globe text-2xl mr-2 icon-globe"></i>
                        <h3 class="text-xl font-semibold text-blue-700">${highlightText(result.title, query)}</h3>
                    </div>
                    <div class="mb-3">
                        <a href="${result.url}" class="text-green-700 hover:underline" target="_blank">
                            ${result.url}
                        </a>
                    </div>
                    <p class="text-gray-700">
                        ${highlightText(result.description, query)}
                    </p>
                `;
                
                card.innerHTML = html;
                webResults.appendChild(card);
            }
            
            // Format a property value
            function formatPropertyValue(value, query) {
                if (value === null || value === undefined) {
                    return '<span class="text-gray-400">None</span>';
                }
                
                // Handle different value types
                if (typeof value === 'string') {
                    // Try to parse JSON strings
                    if ((value.startsWith('{') && value.endsWith('}')) || 
                        (value.startsWith('[') && value.endsWith(']'))) {
                        try {
                            // Replace single quotes with double quotes for JSON parsing
                            const jsonStr = value.replace(/'/g, '"');
                            const parsedValue = JSON.parse(jsonStr);
                            
                            if (Array.isArray(parsedValue)) {
                                return formatArray(parsedValue, query);
                            } else if (typeof parsedValue === 'object') {
                                return formatObject(parsedValue, query);
                            }
                        } catch (e) {
                            // If parsing fails, just highlight the text
                            console.log('Failed to parse:', value);
                            return highlightText(value, query);
                        }
                    }
                    
                    // Check if it's a URL
                    if (value.match(/^https?:\/\//)) {
                        return `<a href="${value}" class="text-blue-600 hover:underline" target="_blank">${highlightText(value, query)}</a>`;
                    }
                    
                    // Regular string
                    return highlightText(value, query);
                } else if (Array.isArray(value)) {
                    return formatArray(value, query);
                } else if (typeof value === 'object' && value !== null) {
                    return formatObject(value, query);
                } else {
                    // Numbers, booleans, etc.
                    return highlightText(String(value), query);
                }
            }
            
            // Format an array
            function formatArray(arr, query) {
                if (arr.length === 0) {
                    return '<span class="text-gray-400">Empty list</span>';
                }
                
                let html = '<ul class="list-disc pl-5 space-y-1">';
                
                arr.forEach(item => {
                    if (typeof item === 'object' && item !== null) {
                        html += `<li>${formatObject(item, query)}</li>`;
                    } else {
                        html += `<li>${highlightText(String(item), query)}</li>`;
                    }
                });
                
                html += '</ul>';
                return html;
            }
            
            // Format an object
            function formatObject(obj, query) {
                let html = '<div class="pl-3 border-l-2 border-gray-200 space-y-1">';
                
                Object.entries(obj).forEach(([key, value]) => {
                    html += `<div><span class="font-medium">${formatKey(key)}:</span> `;
                    
                    if (typeof value === 'object' && value !== null) {
                        if (Array.isArray(value)) {
                            html += formatArray(value, query);
                        } else {
                            html += formatObject(value, query);
                        }
                    } else {
                        html += highlightText(String(value), query);
                    }
                    
                    html += '</div>';
                });
                
                html += '</div>';
                return html;
            }
            
            // Format a key
            function formatKey(key) {
                return key.split(/[_\s]/).map(word => 
                    word.charAt(0).toUpperCase() + word.slice(1)
                ).join(' ');
            }
            
            // Highlight matching text
            function highlightText(text, query) {
                if (!text || !query) return text;
                
                const words = query.toLowerCase().split(/\s+/).filter(word => word.length > 2);
                let result = text;
                
                words.forEach(word => {
                    const regex = new RegExp('(' + escapeRegExp(word) + ')', 'gi');
                    result = result.replace(regex, '<span class="highlight">$1</span>');
                });
                
                return result;
            }
            
            // Escape special regex characters
            function escapeRegExp(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }
            
            // Event listeners
            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keydown', e => {
                if (e.key === 'Enter') performSearch();
            });
            
            // Initial load
            loadKnowledgeBase();
            searchInput.focus();
        });
    </script>
</body>
</html>
